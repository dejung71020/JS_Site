<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìƒˆ ê¸€ ì‘ì„± - Doogle</title>
    <style>
      /* CSS ìŠ¤íƒ€ì¼ì€ main.htmlì˜ ìŠ¤íƒ€ì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤. */
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap");

      :root {
        --google-blue: #4285f4;
        --google-dark-text: #202124;
        --google-light-text: #5f6368;
        --background-color: #f8f9fa;
        --input-border-color: #dadce0;
        --input-focus-shadow: 0 0 0 1px var(--google-blue);
      }

      body {
        font-family: "Roboto", sans-serif;
        background-color: var(--background-color);
        margin: 0;
        padding: 0;
      }

      /* ìƒë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë°” */
      .app-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        background-color: #fff;
        border-bottom: 1px solid #dadce0;
      }

      .logo-text {
        font-size: 24px;
        font-weight: 500;
        /* í´ë¦­ ì‹œ ë©”ì¸ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ a íƒœê·¸ë¡œ ê°ìŒ€ ê²½ìš° ì•„ë˜ ìŠ¤íƒ€ì¼ ì ìš© */
        text-decoration: none;
      }
      .logo-text span:nth-child(1) {
        color: #4285f4;
      } /* Blue */
      .logo-text span:nth-child(2) {
        color: #ea4335;
      } /* Red */
      .logo-text span:nth-child(3) {
        color: #fbbc05;
      } /* Yellow */
      .logo-text span:nth-child(4) {
        color: #4285f4;
      } /* Blue */
      .logo-text span:nth-child(5) {
        color: #34a853;
      } /* Green */
      .logo-text span:nth-child(6) {
        color: #ea4335;
      } /* Red */

      /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
      .main-content {
        max-width: 800px;
        margin: 40px auto;
        padding: 0 20px;
      }

      /* â˜…â˜…â˜… ê²Œì‹œê¸€ í¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì¶”ê°€ â˜…â˜…â˜… */
      .post-form-container {
        background-color: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); /* ì€ì€í•œ ê·¸ë¦¼ì */
      }

      h1 {
        color: var(--google-dark-text);
        font-weight: 400;
        border-bottom: 2px solid #dadce0;
        padding-bottom: 10px;
        margin-bottom: 25px;
      }

      /* â˜…â˜…â˜… í¼ ê·¸ë£¹ ë° ì¸í’‹ ìŠ¤íƒ€ì¼ í†µí•© â˜…â˜…â˜… */
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--google-dark-text);
        font-size: 14px;
      }

      /* ì œëª© ì¸í’‹ í•„ë“œ ìŠ¤íƒ€ì¼ */
      #postTitle {
        width: 100%;
        padding: 15px;
        margin-bottom: 20px; /* ê¸°ì¡´ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ëŒ€ì²´ */
        border: 1px solid var(--input-border-color);
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 18px; /* ì œëª©ì„ì„ ê°•ì¡° */
        font-weight: 500;
        font-family: "Roboto", sans-serif;
        transition: border-color 0.3s;
      }

      /* ë‚´ìš© í…ìŠ¤íŠ¸ ì˜ì—­ ìŠ¤íƒ€ì¼ */
      textarea {
        width: 100%;
        min-height: 300px;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid var(--input-border-color);
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
        font-family: "Roboto", sans-serif;
        transition: border-color 0.3s;
        resize: vertical;
      }

      #postTitle:focus,
      textarea:focus {
        border-color: var(--google-blue);
        outline: none;
        box-shadow: var(--input-focus-shadow);
      }

      /* ë²„íŠ¼ ì˜ì—­ */
      .button-area {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding-top: 15px; /* í¼ê³¼ì˜ ê°„ê²© í™•ë³´ */
      }

      .primary-btn {
        padding: 10px 24px;
        background-color: var(--google-blue);
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .primary-btn:hover {
        background-color: #357ae8;
      }

      .secondary-btn {
        padding: 10px 24px;
        background-color: #fff;
        color: var(--google-dark-text);
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .secondary-btn:hover {
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <div class="app-bar">
      <a href="main.html" style="text-decoration: none">
        <div class="logo-text">
          <span>D</span><span>o</span><span>o</span><span>g</span><span>l</span
          ><span>e</span>
        </div>
      </a>
      <button class="secondary-btn" onclick="location.href='main.html'">
        ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </button>
    </div>

    <div class="main-content">
      <h1>ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h1>

      <div class="post-form-container">
        <form id="postForm">
          <input
            type="text"
            id="postTitle"
            placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (í•„ìˆ˜)"
            required
          />

          <textarea
            id="postText"
            placeholder="ì—¬ê¸°ì— ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."
            required
          ></textarea>

          <div class="button-area">
            <button
              type="button"
              class="secondary-btn"
              onclick="location.href='main.html'"
            >
              ì·¨ì†Œ
            </button>
            <button type="submit" class="primary-btn" id="submitBtn">
              ì‘ì„± ì™„ë£Œ
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      const BASE_URL = "http://127.0.0.1:8080";

      // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("postForm")
        .addEventListener("submit", createPostHandler);

      async function createPostHandler(event) {
        event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

        // â˜…â˜…â˜… ì œëª© í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸° â˜…â˜…â˜…
        const postTitle = document.getElementById("postTitle").value.trim();
        const postText = document.getElementById("postText").value.trim();
        const token = localStorage.getItem("token");

        if (!token) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          window.location.href = "index.html";
          return;
        }

        // â˜…â˜…â˜… ì œëª©ê³¼ ë‚´ìš© ëª¨ë‘ ê²€ì¦ â˜…â˜…â˜…
        if (postTitle.length === 0 || postText.length === 0) {
          alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          // ë°±ì—”ë“œ ë¼ìš°íŠ¸ /post ì‚¬ìš©
          const response = await fetch(`${BASE_URL}/post`, {
            // POST /post ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`, // ì¸ì¦ í† í° ì²¨ë¶€
            },
            // â˜…â˜…â˜… bodyì— titleê³¼ text ëª¨ë‘ ì „ì†¡ â˜…â˜…â˜…
            body: JSON.stringify({ title: postTitle, text: postText }),
          });

          const result = await response.json();

          if (response.ok) {
            alert("ğŸ‰ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ì„±ê³µ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = "main.html";
          } else if (response.status === 401 || response.status === 403) {
            alert(`ì‘ì„± ê¶Œí•œ ì˜¤ë¥˜: ${result.message}. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.`);
            localStorage.removeItem("token");
            window.location.href = "index.html";
          } else if (response.status === 400) {
            // ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ (ì˜ˆ: ì œëª© ê¸€ì ìˆ˜ ì´ˆê³¼)
            alert(
              `ì…ë ¥ ì˜¤ë¥˜: ${result.message || "ì œëª©ì´ë‚˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”."}`
            );
          } else {
            alert(`ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨: ${result.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }
    </script>
  </body>
</html>
