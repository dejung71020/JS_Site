<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìƒˆ ê¸€ ì‘ì„± - Doogle</title>
    <style>
      /* CSS ìŠ¤íƒ€ì¼ì€ main.htmlì˜ ìŠ¤íƒ€ì¼ì„ ê¸°ë°˜ìœ¼ë¡œ ì ìš©í•©ë‹ˆë‹¤. */
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;500s;700&display=swap");

      :root {
        --google-blue: #4285f4;
        --google-dark-text: #202124;
        --google-light-text: #5f6368;
        --background-color: #f8f9fa;
      }

      body {
        font-family: "Roboto", sans-serif;
        background-color: var(--background-color);
        margin: 0;
        padding: 0;
      }

      /* ìƒë‹¨ ë‚´ë¹„ê²Œì´ì…˜ ë°” */
      .app-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        background-color: #fff;
        border-bottom: 1px solid #dadce0;
      }

      .logo-text {
        font-size: 24px;
        font-weight: 500;
      }
      .logo-text span:nth-child(1) {
        color: #4285f4;
      }
      .logo-text span:nth-child(2) {
        color: #ea4335;
      }
      .logo-text span:nth-child(3) {
        color: #fbbc05;
      }
      .logo-text span:nth-child(4) {
        color: #4285f4;
      }

      /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
      .main-content {
        max-width: 800px; /* ê²Œì‹œê¸€ ì‘ì„± í¼ì— ì í•©í•œ ë„ˆë¹„ */
        margin: 40px auto;
        padding: 0 20px;
      }

      h1 {
        color: var(--google-dark-text);
        font-weight: 400;
        border-bottom: 2px solid #dadce0;
        padding-bottom: 10px;
        margin-bottom: 25px;
      }

      /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
      textarea {
        width: 100%;
        min-height: 300px; /* ë‚´ìš© ì…ë ¥ ì˜ì—­ í™•ë³´ */
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
        font-family: "Roboto", sans-serif;
        transition: border-color 0.3s;
        resize: vertical; /* ìˆ˜ì§ í¬ê¸° ì¡°ì ˆë§Œ í—ˆìš© */
      }

      textarea:focus {
        border-color: var(--google-blue);
        outline: none;
        box-shadow: 0 0 0 1px var(--google-blue);
      }

      /* ë²„íŠ¼ ì˜ì—­ */
      .button-area {
        display: flex;
        justify-content: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
        gap: 10px;
      }

      .primary-btn {
        padding: 10px 24px;
        background-color: var(--google-blue);
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .primary-btn:hover {
        background-color: #357ae8;
      }

      .secondary-btn {
        padding: 10px 24px;
        background-color: #fff;
        color: var(--google-dark-text);
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .secondary-btn:hover {
        background-color: #f0f0f0;
      }
    </style>
  </head>
  <body>
    <div class="app-bar">
      <div class="logo-text">
        <span>D</span><span>o</span><span>o</span><span>g</span><span>l</span
        ><span>e</span>
      </div>
      <button class="secondary-btn" onclick="location.href='main.html'">
        ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      </button>
    </div>

    <div class="main-content">
      <h1>ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h1>

      <form id="postForm">
        <input
          type="text"
          id="postTitle"
          placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (í•„ìˆ˜)"
          required
          style="
            padding: 15px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
          "
        />

        <textarea
          id="postText"
          placeholder="ì—¬ê¸°ì— ê²Œì‹œê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."
          required
        ></textarea>

        <div class="button-area">
          <button
            type="button"
            class="secondary-btn"
            onclick="location.href='main.html'"
          >
            ì·¨ì†Œ
          </button>
          <button type="submit" class="primary-btn" id="submitBtn">
            ì‘ì„± ì™„ë£Œ
          </button>
        </div>
      </form>
    </div>

    <script>
      const BASE_URL = "http://127.0.0.1:8080";

      // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document
        .getElementById("postForm")
        .addEventListener("submit", createPostHandler);

      async function createPostHandler(event) {
        event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

        // â˜…â˜…â˜… ì œëª© í•„ë“œ ê°’ ê°€ì ¸ì˜¤ê¸° â˜…â˜…â˜…
        const postTitle = document.getElementById("postTitle").value.trim();
        const postText = document.getElementById("postText").value.trim();
        const token = localStorage.getItem("token");

        if (!token) {
          alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          window.location.href = "index.html";
          return;
        }

        // â˜…â˜…â˜… ì œëª©ê³¼ ë‚´ìš© ëª¨ë‘ ê²€ì¦ â˜…â˜…â˜…
        if (postTitle.length === 0 || postText.length === 0) {
          alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          // ë°±ì—”ë“œ ë¼ìš°íŠ¸ /posts ì‚¬ìš©
          const response = await fetch(`${BASE_URL}/post`, {
            // POST /post ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`, // ì¸ì¦ í† í° ì²¨ë¶€
            },
            // â˜…â˜…â˜… bodyì— titleê³¼ text ëª¨ë‘ ì „ì†¡ â˜…â˜…â˜…
            body: JSON.stringify({ title: postTitle, text: postText }),
          });

          const result = await response.json();

          if (response.ok) {
            alert("ğŸ‰ ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!");
            // ì„±ê³µ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = "main.html";
          } else if (response.status === 401 || response.status === 403) {
            alert(`ì‘ì„± ê¶Œí•œ ì˜¤ë¥˜: ${result.message}. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.`);
            localStorage.removeItem("token");
            window.location.href = "index.html";
          } else if (response.status === 400) {
            // ìœ íš¨ì„± ê²€ì‚¬ ì˜¤ë¥˜ (ì˜ˆ: ì œëª© ê¸€ì ìˆ˜ ì´ˆê³¼)
            alert(
              `ì…ë ¥ ì˜¤ë¥˜: ${result.message || "ì œëª©ì´ë‚˜ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”."}`
            );
          } else {
            alert(`ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨: ${result.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }
    </script>
  </body>
</html>
