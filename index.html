<!-- index.html -->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ë¡œê·¸ì¸ í˜ì´ì§€</title>
  </head>
  <body>
    <h1>ë¡œê·¸ì¸ (index) ğŸ”‘</h1>
    <form>
      <label for="loginId">ì•„ì´ë””:</label>
      <input type="text" id="loginId" placeholder="ì•„ì´ë”” ì…ë ¥" required />
      <br /><br />
      <label for="loginPw">ë¹„ë°€ë²ˆí˜¸:</label>
      <input
        type="password"
        id="loginPw"
        placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
        required
      />
      <br /><br />
      <button type="button" id="loginBtn">ë¡œê·¸ì¸ ìš”ì²­</button>
    </form>

    <hr />
    <p>
      ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="./signup.html">íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™</a>
    </p>
    <script>
      // ë°±ì—”ë“œ ì£¼ì†Œ (HOST_PORT: 8080ì— ë§ê²Œ ì„¤ì •)
      const BASE_URL = "http://127.0.0.1:8080";

      // 2. íšŒì›ê°€ì… ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      document
        .getElementById("loginBtn")
        .addEventListener("click", loginHandler);

      async function loginHandler() {
        // í¼ í•„ë“œì—ì„œ ë°ì´í„° ì¶”ì¶œ
        const data = {
          userid: document.getElementById("loginId").value,
          password: document.getElementById("loginPw").value,
        };

        // í•„ë“œ ì¤‘ í•˜ë‚˜ë¼ë„ ë¹„ì–´ìˆëŠ”ì§€ ê¸°ë³¸ ê²€ì‚¬ (ë°±ì—”ë“œì—ì„œ ìƒì„¸ ê²€ì‚¬)
        if (Object.values(data).some((value) => value === "")) {
          alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”");
          return;
        }

        try {
          const response = await fetch(`${BASE_URL}/auth/login`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            // ë°ì´í„°ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            // 201 Created ì„±ê³µ ì‹œ
            alert("ğŸ‰ ë¡œê·¸ì¸! ë¡œê·¸ì¸ í›„ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");

            // JWT í† í°ì„ localStorageì— ì €ì¥ (ì„ íƒ ì‚¬í•­, ë¡œê·¸ì¸ APIì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë¨)
            localStorage.setItem("token", result.token);

            window.location.href = "index.html"; // ì¼ë‹¨ ë‹¤ë¥¸í˜ì´ì§€ê°€ ì—†ì–´ì„œ ì´ë™ì—†ìŒ
          } else if (response.status === 400) {
            // 400 Bad Request (ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨)
            alert(`ì…ë ¥ ì˜¤ë¥˜: ${result.message}`);
          } else {
            // ê¸°íƒ€ ì„œë²„ ì˜¤ë¥˜
            alert(
              `íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${
                result.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"
              })`
            );
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.");
        }
      }
    </script>
  </body>
</html>
