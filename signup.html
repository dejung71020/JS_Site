<!DOCTYPE html>
<html lang="ko">
   
  <head>
       
    <meta charset="UTF-8" />
       
    <title>회원가입 페이지</title>
     
  </head>
   
  <body>
       
    <h1>회원가입 (Register) 📝</h1>
       
    <form id="signupForm">
            <label for="userid">아이디:</label>      
      <input type="text" id="userid" placeholder="사용할 아이디" required />    
        <br /><br />
            <label for="userpw">비밀번호:</label>      
      <input type="password" id="userpw" placeholder="비밀번호" required />    
        <br /><br />
            <label for="name">이름:</label>      
      <input type="text" id="name" placeholder="이름" required />      
      <br /><br />
            <label for="year">연도</label>      
      <input type="text" id="year" placeholder="연도 (예: 1990)" required />    
        <br /><br />
           
      <select id="birthMonth" required>
               
        <option value="">월</option>
             
      </select>
            <label for="day">일</label>      
      <input type="text" id="day" placeholder="일 (예: 25)" required />      
      <br /><br />
            <label for="email">이메일:</label>      
      <input type="email" id="email" placeholder="이메일 주소" required />      
      <br /><br />
            <label for="gender">성별:</label>      
      <select id="gender" required>
               
        <option value="">선택</option>
               
        <option value="male">남성</option>
               
        <option value="female">여성</option>
               
        <option value="other">기타</option>
             
      </select>
            <br /><br />
            <button type="button" id="signupBtn">회원가입 요청</button>    
    </form>

       
    <hr />
       
    <p>이미 계정이 있으신가요? <a href="index.html">로그인 페이지로 이동</a></p>

       
    <script>
      // 백엔드 주소 (HOST_PORT: 8080에 맞게 설정)
      const BASE_URL = "http://localhost:8080";

      // 1. 월 옵션 동적 생성 (기존 코드 유지)
      const monthSelect = document.getElementById("birthMonth");
      for (let i = 1; i <= 12; i++) {
        const option = document.createElement("option");
        // 백엔드 유효성 검사 기준(1~12 정수)에 맞춤
        option.value = i;
        option.textContent = i + "월";
        monthSelect.appendChild(option);
      }

      // 2. 회원가입 버튼 이벤트 리스너 추가
      document
        .getElementById("signupBtn")
        .addEventListener("click", signupHandler);

      async function signupHandler() {
        // 폼 필드에서 데이터 추출
        const data = {
          userid: document.getElementById("userid").value,
          password: document.getElementById("userpw").value,
          name: document.getElementById("name").value,
          birth_year: document.getElementById("year").value,
          birth_month: document.getElementById("birthMonth").value,
          birth_day: document.getElementById("day").value,
          email: document.getElementById("email").value,
          gender: document.getElementById("gender").value,
        };

        // 필드 중 하나라도 비어있는지 기본 검사 (백엔드에서 상세 검사)
        if (Object.values(data).some((value) => value === "")) {
          alert("모든 필드를 입력해주세요.");
          return;
        }

        try {
          const response = await fetch(`${BASE_URL}/auth/signup`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            // 데이터를 JSON 문자열로 변환하여 전송
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            // 201 Created 성공 시
            alert("🎉 회원가입 성공! 이제 로그인 페이지로 이동합니다.");

            // JWT 토큰을 localStorage에 저장 (선택 사항, 로그인 API에서 주로 사용됨)
            // localStorage.setItem('token', result.token);

            window.location.href = "index.html"; // 로그인 페이지로 리디렉션
          } else if (response.status === 409) {
            // 409 Conflict (아이디 중복)
            alert(`회원가입 실패: ${result.message}`);
          } else if (response.status === 400) {
            // 400 Bad Request (유효성 검사 실패)
            alert(`입력 오류: ${result.message}`);
          } else {
            // 기타 서버 오류
            alert(
              `회원가입 중 오류가 발생했습니다. (${
                result.message || "알 수 없는 오류"
              })`
            );
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          alert("서버 연결에 실패했습니다. 서버가 실행 중인지 확인하세요.");
        }
      }
    </script>
     
  </body>
</html>
